---
import Section from "./ui/Section.astro";
import Container from "./ui/Container.astro";
import SectionHeader from "./ui/SectionHeader.astro";
import Button from "./ui/Button.astro";
import { useTranslations } from "../i18n/utils";

interface Props {
    lang: "es" | "en";
}

const { lang } = Astro.props;
const t = useTranslations(lang);
---

<Section id="contact">
    <Container className="max-w-4xl">
        <SectionHeader
            title={t("contact.title")}
            subtitle={t("contact.subtitle")}
            description={t("contact.desc")}
        />

        <div
            class="glass-card p-8 md:p-12 rounded-2xl relative overflow-hidden"
        >
            <div
                class="absolute top-0 right-0 p-12 opacity-20 pointer-events-none"
            >
                <div class="w-64 h-64 bg-primary/30 rounded-full blur-3xl">
                </div>
            </div>

            <form id="contact-form" class="space-y-6 relative z-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label
                            for="name"
                            class="text-sm font-medium text-gray-300 ml-1"
                            >{t("contact.form.name")}</label
                        >
                        <input
                            type="text"
                            id="name"
                            name="name"
                            required
                            class="w-full bg-dark/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300"
                            placeholder="John Doe"
                        />
                    </div>
                    <div class="space-y-2">
                        <label
                            for="email"
                            class="text-sm font-medium text-gray-300 ml-1"
                            >{t("contact.form.email")}</label
                        >
                        <input
                            type="email"
                            id="email"
                            name="email"
                            required
                            class="w-full bg-dark/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300"
                            placeholder="john@example.com"
                        />
                    </div>
                </div>

                <div class="space-y-2">
                    <label
                        for="subject"
                        class="text-sm font-medium text-gray-300 ml-1"
                        >{t("contact.form.subject")}</label
                    >
                    <select
                        id="subject"
                        name="subject"
                        class="w-full bg-dark/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300 cursor-pointer"
                    >
                        <option value="Oportunidad Laboral"
                            >{
                                lang === "es"
                                    ? "Oportunidad Laboral"
                                    : "Job Opportunity"
                            }</option
                        >
                        <option value="Proyecto Freelance"
                            >{
                                lang === "es"
                                    ? "Proyecto Freelance"
                                    : "Freelance Project"
                            }</option
                        >
                        <option value="Colaboración"
                            >{
                                lang === "es" ? "Colaboración" : "Collaboration"
                            }</option
                        >
                        <option value="Otros"
                            >{lang === "es" ? "Otros" : "Other"}</option
                        >
                    </select>
                </div>

                <div class="space-y-2">
                    <label
                        for="message"
                        class="text-sm font-medium text-gray-300 ml-1"
                        >{t("contact.form.message")}</label
                    >
                    <textarea
                        id="message"
                        name="message"
                        rows="5"
                        required
                        class="w-full bg-dark/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300 resize-none"
                        placeholder="..."></textarea>
                </div>

                <Button
                    type="submit"
                    variant="primary"
                    className="w-full md:w-auto min-w-[200px]"
                >
                    {
                        lang === "es"
                            ? "Enviar por WhatsApp"
                            : "Send via WhatsApp"
                    }
                </Button>

                <p id="form-status" class="text-center text-sm mt-4 hidden"></p>
            </form>
        </div>
    </Container>
</Section>

<script
    define:vars={{
        submitText: lang === "es" ? "Enviar por WhatsApp" : "Send via WhatsApp",
    }}
>
    const form = document.getElementById("contact-form");

    form?.addEventListener("submit", (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const name = formData.get("name");
        const email = formData.get("email");
        const subject = formData.get("subject");
        const message = formData.get("message");

        // WhatsApp number (REPLACE THIS WITH YOUR NUMBER)
        const phone = "34658823543";

        const whatsappMessage = encodeURIComponent(
            `*Nuevo mensaje de contacto desde la web*\n\n` +
                `*Nombre:* ${name}\n` +
                `*Email:* ${email}\n` +
                `*Asunto:* ${subject}\n\n` +
                `*Mensaje:*\n${message}`,
        );

        const whatsappUrl = `https://wa.me/${phone}?text=${whatsappMessage}`;

        // Open WhatsApp in a new tab
        window.open(whatsappUrl, "_blank");
        form.reset();
    });
</script>
